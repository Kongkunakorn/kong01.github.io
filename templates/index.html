{% extends "base.html" %}
{% block title %}Typing Test{% endblock %}

{% block content %}
<div class="center" id="current-word">Loading...</div>
<div class="input-center">
  <div id="letter-boxes" style="margin-bottom: 20px"></div>
  <input id="hidden-input" type="text" maxlength="30" autocomplete="off" autocorrect="off" autocapitalize="off"
    style="position:absolute; opacity:0; width:1px; height:1px; border:none;" />
</div>
<p class="center" id="translation"></p>

<!-- แถบประวัติ: เปิดอยู่ตั้งแต่เริ่ม -->
<aside id="history-panel" class="open" aria-hidden="false" style="
  position: fixed; left: 0; top: 0; bottom: 0; width: 300px; max-width: 85vw;
  background: #111; color: #eee; border-right: 1px solid #333; transform: translateX(0);
  transition: transform .2s ease; z-index: 1000; display: flex; flex-direction: column;">
  <div
    style="display:flex; align-items:center; justify-content:space-between; padding:12px 12px; border-bottom:1px solid #333">
    <strong>Past Words</strong>
    <!-- ปุ่มปิด -->
    <button id="history-close" title="Close"
      style="background:#222; color:#ddd; border:1px solid #444; border-radius:6px; padding:4px 8px; cursor:pointer;">✕</button>
  </div>
  <div id="history-list" style="overflow:auto; padding: 10px 12px; gap:8px; display:flex; flex-direction:column;"></div>
  <div class="resize-handle"></div>
</aside>

<!-- ปุ่ม History (จะโผล่มาเฉพาะตอน panel ปิด) -->
<button id="history-open" class="history-btn" type="button">History</button>
{% endblock %}


{% block scripts %}

<script>
  window.words = JSON.parse('{{ words | safe }}');
  window.category = "{{ category }}";
  window.srcLang = "{{ src }}";
  window.destLang = "{{ dest }}";
  window.HOME_URL = "{{ url_for('home') }}";

  (function () {
    const panel = document.getElementById('history-panel');
    const handle = panel?.querySelector('.resize-handle');
    if (!panel || !handle) return;

    let startX, startWidth;

    handle.addEventListener('mousedown', (e) => {
      startX = e.clientX;
      startWidth = panel.offsetWidth;
      document.documentElement.style.cursor = 'ew-resize';
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);
      e.preventDefault();
    });

    function onDrag(e) {
      const dx = e.clientX - startX;
      let newWidth = startWidth + dx;
      if (newWidth < 200) newWidth = 200;
      if (newWidth > window.innerWidth * 0.85) newWidth = window.innerWidth * 0.85;
      panel.style.width = newWidth + "px";
    }

    function stopDrag() {
      document.documentElement.style.cursor = '';
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', stopDrag);
    }
  })();
</script>

<script src="{{ url_for('static', filename='js/typing_game.js') }}"></script>
{% endblock %}